<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}ZHub{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* Sidebar custom scrollbar */
    .sidebar-nav::-webkit-scrollbar { width: 4px; }
    .sidebar-nav::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body class="h-full bg-gray-50">
  <div class="flex h-full">

    {# ── Mobile overlay ── #}
    <div id="sidebar-overlay" class="fixed inset-0 z-30 bg-black/50 hidden lg:hidden" onclick="toggleSidebar()"></div>

    {# ── Sidebar ── #}
    <aside id="sidebar"
           class="fixed inset-y-0 left-0 z-40 flex w-64 flex-col bg-[#1a1a2e] text-white
                  transform -translate-x-full transition-transform lg:translate-x-0 lg:static lg:z-auto">

      {# Logo #}
      <div class="flex h-16 items-center gap-2 px-6 border-b border-white/10">
        <svg class="h-8 w-8 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <span class="text-xl font-bold tracking-tight">ZHub</span>
      </div>

      {# Navigation #}
      <nav class="sidebar-nav flex-1 overflow-y-auto px-3 py-4 space-y-1">

        {# Dashboard #}
        <a href="{% url 'dashboard:index' %}"
           class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium
                  {% if request.resolver_match.app_name == 'dashboard' %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955a1.126 1.126 0 011.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/>
          </svg>
          Dashboard
        </a>

        {# Studios #}
        <div class="pt-4">
          <p class="px-3 text-xs font-semibold uppercase tracking-wider text-gray-500">Studios</p>
          <div class="mt-2 space-y-1">
            {% for s in sidebar_studios %}
            <a href="{% url 'studios:detail' slug=s.slug %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm
                      {% if request.resolver_match.app_name == 'studios' and request.resolver_match.kwargs.slug == s.slug %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/>
              </svg>
              {{ s.name }}
            </a>
            {% endfor %}
            <a href="{% url 'studios:combined' %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm
                      {% if request.resolver_match.url_name == 'combined' and request.resolver_match.app_name == 'studios' %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/>
              </svg>
              Combined View
            </a>
          </div>
        </div>

        {# Properties #}
        <div class="pt-4">
          <p class="px-3 text-xs font-semibold uppercase tracking-wider text-gray-500">Properties</p>
          <div class="mt-2 space-y-1">
            <a href="{% url 'properties:list' %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm
                      {% if request.resolver_match.url_name == 'list' and request.resolver_match.app_name == 'properties' %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5M3.75 3v18m16.5-18v18M5.25 3h13.5M5.25 21h13.5M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15"/>
              </svg>
              Portfolio
            </a>
            <a href="{% url 'properties:add' %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
              </svg>
              Add Property
            </a>
          </div>
        </div>

        {# Budget #}
        <div class="pt-4">
          <p class="px-3 text-xs font-semibold uppercase tracking-wider text-gray-500">Budget</p>
          <div class="mt-2 space-y-1">
            <a href="{% url 'budget:overview' %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm
                      {% if request.resolver_match.url_name == 'overview' and request.resolver_match.app_name == 'budget' %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Overview
            </a>
            <a href="{% url 'budget:transactions' %}"
               class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/>
              </svg>
              Transactions
            </a>
            <span class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-gray-500 cursor-not-allowed">
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"/>
              </svg>
              Accounts
              <span class="ml-auto rounded bg-gray-700 px-1.5 py-0.5 text-[10px] font-medium text-gray-400">Coming Soon</span>
            </span>
          </div>
        </div>

        {# Settings #}
        <div class="pt-4">
          <a href="{% url 'accounts:settings' %}"
             class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm
                    {% if request.resolver_match.app_name == 'accounts' %}bg-white/10 text-emerald-400{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">
            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/>
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Settings
          </a>
        </div>
      </nav>

      {# Sidebar footer #}
      <div class="border-t border-white/10 px-4 py-3">
        <p class="text-xs text-gray-500 text-center">ZHub &copy; 2025</p>
      </div>
    </aside>

    {# ── Main content area ── #}
    <div class="flex flex-1 flex-col min-w-0 lg:ml-0">

      {# Top bar #}
      <header class="sticky top-0 z-20 flex h-16 items-center gap-4 border-b bg-white px-4 shadow-sm">
        {# Mobile menu button #}
        <button onclick="toggleSidebar()" class="lg:hidden rounded-md p-2 text-gray-500 hover:bg-gray-100">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
          </svg>
        </button>

        {# Logo (mobile) #}
        <span class="text-lg font-bold text-[#1a1a2e] lg:hidden">ZHub</span>

        {# Breadcrumbs #}
        <nav class="hidden lg:flex items-center gap-2 text-sm text-gray-500">
          <a href="{% url 'dashboard:index' %}" class="hover:text-gray-700">ZHub</a>
          {% for crumb in breadcrumbs %}
            <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            {% if crumb.url %}
              <a href="{{ crumb.url }}" class="hover:text-gray-700">{{ crumb.label }}</a>
            {% else %}
              <span class="text-gray-900 font-medium">{{ crumb.label }}</span>
            {% endif %}
          {% endfor %}
        </nav>

        {# Spacer #}
        <div class="flex-1"></div>

        {# User dropdown #}
        {% if user.is_authenticated %}
        <div class="relative" id="user-menu">
          <button onclick="document.getElementById('user-dropdown').classList.toggle('hidden')"
                  class="flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100">
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-100 text-emerald-700 font-semibold text-sm">
              {{ user.first_name|default:user.username|make_list|first|upper }}
            </div>
            <span class="hidden sm:inline">{{ user.get_full_name|default:user.username }}</span>
            <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>
          <div id="user-dropdown"
               class="hidden absolute right-0 mt-1 w-48 rounded-lg bg-white py-1 shadow-lg ring-1 ring-black/5">
            <a href="{% url 'accounts:settings' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile &amp; Settings</a>
            <hr class="my-1">
            <a href="{% url 'account_logout' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Sign out</a>
          </div>
        </div>
        {% endif %}
      </header>

      {# Page content #}
      <main class="flex-1 overflow-y-auto p-6">
        {# Flash messages #}
        {% if messages %}
        <div class="mb-6 space-y-2">
          {% for message in messages %}
          <div class="rounded-lg border px-4 py-3 text-sm
                      {% if message.tags == 'success' %}border-emerald-200 bg-emerald-50 text-emerald-800
                      {% elif message.tags == 'error' %}border-red-200 bg-red-50 text-red-800
                      {% else %}border-blue-200 bg-blue-50 text-blue-800{% endif %}">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  {# Close dropdown when clicking outside #}
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    }

    document.addEventListener('click', function(e) {
      const menu = document.getElementById('user-menu');
      const dropdown = document.getElementById('user-dropdown');
      if (menu && dropdown && !menu.contains(e.target)) {
        dropdown.classList.add('hidden');
      }
    });
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
